<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Watch QC JR</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
body {
    font-family: 'Inter', sans-serif;
    background: #1a1a1a;
    color: #fff;
    overflow: hidden;
}
.container {
    display: flex;
    height: 100vh;
}
.sidebar {
    width: 250px;
    background: #2d2d2d;
    padding: 7px 5px 10px 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1000;
    transition: transform 0.22s cubic-bezier(.86,0,.07,1.01);
    position: relative;
}
.logo-btn-row {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 8px;
    gap: 8px;
    margin-top: 2px;
}
.logo-compact {
    max-width: 250px;
    max-height: 125px;
    width: 100%;
    height: auto;
    display: block;
    margin: 0 auto 4px auto;
    object-fit: contain;
    background: transparent;
    border: none;
    padding: 0;
    box-shadow: none;
    outline: none;
}
.sidebar-menu {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.tool-btn {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    padding: 9px 10px;
    background: #3d3d3d;
    border: none;
    border-radius: 7px;
    color: #fff;
    cursor: pointer;
    font-size: 15px;
    transition: background 0.2s;
}
.tool-btn:hover { background: #4d4d4d; }
.section-title {
    font-size: 13px;
    color: #aaa;
    margin: 17px 0 4px 0;
    font-weight: 500;
    letter-spacing: 0.5px;
    text-align: left;
    width:100%;
}
.checklist {
    width: 100%;
    list-style: none;
    padding-left: 0;
    margin-left: 0;
    display: flex;
    flex-direction: column;
    gap: 2px;
    margin-bottom: 2px;
}
.checklist li {
    display: flex;
    align-items: center;
    gap: 7px;
    font-size: 15px;
    cursor: pointer;
    background: none;
    border: none;
    padding: 7px 3px 6px 0;
    margin: 0;
    border-radius: 4px;
    transition: background 0.1s;
    text-align:left;
}
.checklist li:hover { background: #38355555; }
.checklist input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
    margin-right:3px;
}
.checklist li.completed {
    opacity: 0.6;
    text-decoration: line-through;
}
.credits {
    margin-top: 11px;
    color: #888;
    font-size: 11.5px;
    text-align: center;
    border-top: 1px solid #444;
    padding-top: 7px;
    width: 100%;
    letter-spacing: 0.6px;
}
.main-area {
    flex: 1; position: relative; overflow: hidden; background: #111;
}
.image-container {
    position: absolute; top: 50%; left: 50%;
    transform-origin: center center;
    cursor: grab; user-select: none;
}
.image-container img {
    max-width: none; max-height: none; display: block; pointer-events: none;
    transform-origin: center center;
}
.tools-overlay {
    position: absolute;
    top: 0;  left: 0; right: 0; bottom: 0;
    pointer-events: none;
    z-index: 500;
}
.horizontal-line {
    position: absolute;
    height: 1px; width: 100vw;
    background: yellow;
    box-shadow: 0 0 6px #ffe066b4 !important;
    cursor: ns-resize; pointer-events: auto; left: 0;
    display: flex; align-items: center;
}
.horizontal-line .line-icon {
    margin-left: 3px;
    font-size: 16px;
    color: #ff9f04;
    text-shadow: 1px 0 4px #fff3;
}
.vertical-line {
    position: absolute; width: 1px; height: 100vh;
    background: #2ee85e;
    box-shadow: 0 0 6px #5fd98c7a !important;
    cursor: ew-resize; pointer-events: auto; top: 0;
    display: flex; align-items: flex-end; justify-content: center;
}
.vertical-line .line-icon {
    position: absolute; bottom:6px; left: 50%;
    transform: translateX(-50%);
    display: flex; align-items: center; justify-content: center;
}
.index-ruler {
    position: absolute;
    border: 1.2px solid #ff00cc !important;
    border-radius: 50%;
    background: rgba(255, 0, 200, 0.07) !important;
    box-shadow: 0 0 10px #ff00cc77 !important;
    cursor: move; pointer-events: auto; user-select: none; transform-origin: center center;
}
.index-ruler::before {
    content: '';
    position: absolute;
    top: 50%; left: 50%; width: 100%; height: 100%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    background-image:
        linear-gradient(0deg, transparent 49.92%, #ff00cc 49.92%, #ff00cc 50.08%, transparent 50.08%),
        linear-gradient(90deg, transparent 49.92%, #ff00cc 49.92%, #ff00cc 50.08%, transparent 50.08%),
        linear-gradient(30deg, transparent 49.94%, #ff00cc 49.94%, #ff00cc 50.06%, transparent 50.06%),
        linear-gradient(60deg, transparent 49.94%, #ff00cc 49.94%, #ff00cc 50.06%, transparent 50.06%),
        linear-gradient(120deg, transparent 49.94%, #ff00cc 49.94%, #ff00cc 50.06%, transparent 50.06%),
        linear-gradient(150deg, transparent 49.94%, #ff00cc 49.94%, #ff00cc 50.06%, transparent 50.06%);
}
.index-ruler::after {
    content: '';
    position: absolute;
    top: 50%; left: 50%; width: 8px; height: 8px;
    background: #ff00cc;
    border-radius: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    box-shadow: 0 0 6px #ff00cc77;
}
.controls {
    position: fixed; bottom: 20px; right: 20px;
    display: flex; gap: 10px; z-index: 2000;
}
.control-btn {
    width: 50px; height: 50px; border: none; border-radius: 50%;
    background: #00bcd4; color: white; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; transition: background 0.2s;
}
.control-btn:hover { background: #008ba3; }
.info-panel {
    position: fixed; top: 20px; right: 20px;
    background: rgba(45, 45, 45, 0.9);
    padding: 12px 16px; border-radius: 8px;
    font-size: 14px; z-index: 2000;
}
.hamburger-btn {
    display: none;
}
.sidebar-overlay {
    display: none;
}
@media (max-width: 768px) {
    .container {
        flex-direction: column;
        height: auto;
        min-height: 100vh;
    }
    .sidebar {
        width: 84vw;
        max-width: 320px;
        height: 100vh;
        position: fixed;
        left: 0; top: 0;
        transform: translateX(-105%);
        box-shadow: 2px 0 16px #0009;
        z-index: 2002;
        padding-bottom: 18px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        border-radius: 0 12px 12px 0;
        transition: transform 0.24s cubic-bezier(.77,0,.18,1);
    }
    .sidebar.visible {
        transform: translateX(0);
    }
    .hamburger-btn {
        display: inline-flex;
        position: fixed;
        top: 13px; left: 11px;
        width: 44px; height: 44px;
        align-items: center; justify-content: center;
        background: #2d2d2d;
        border-radius: 13px;
        border: none;
        z-index: 2200;
        box-shadow: 0 1px 7px #0004;
        color: #fff;
        cursor: pointer;
    }
    .main-area {
        min-height: 230px;
    }
    .sidebar-overlay {
        display: block;
        position: fixed;
        left:0; top:0; right:0; bottom:0;
        background: #0005;
        z-index: 2001;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.21s;
    }
    .sidebar.visible ~ .sidebar-overlay {
        opacity: 1;
        pointer-events: all;
    }
}
</style>
</head>
<body>
<button class="hamburger-btn" id="sidebarToggle" aria-label="Abrir menú">
    <span class="material-icons" style="font-size:28px;">menu</span>
</button>
<div class="container">
    <div class="sidebar" id="sidebar">
        <div class="logo-btn-row">
            <img src="logo.png" alt="Watch QC Logo" class="logo-compact">
            <button class="tool-btn" onclick="loadImage()">
                <span class="material-icons">image</span> Load Image
            </button>
            <button class="tool-btn" onclick="saveImage()">
                <span class="material-icons">download</span> Save QC
            </button>
        </div>
        <div class="sidebar-content" style="width:100%;">

            <div class="section-title">Tools</div>
            <br>
            <div class="sidebar-menu">
                <button class="tool-btn" onclick="addIndexRuler()">
                    <span class="material-icons">radio_button_unchecked</span> Index Ruler
                </button>
                <button class="tool-btn" onclick="addHorizontalLine()">
                    <span class="material-icons">remove</span>Horizontal Line
                </button>
                <button class="tool-btn" onclick="addVerticalLine()">
                    <span class="material-icons">add</span>Vertical Line
                </button>
            <br><br>
            </div>
            <div class="section-title" style="margin-top:13px;">QC Checklist</div>
            <ul class="checklist" id="qc-list">
                <li><label><input type="checkbox" onclick="toggleCheck(this)">Aligned indices</label></li>
                <li><label><input type="checkbox" onclick="toggleCheck(this)">Centered date</label></li>
                <li><label><input type="checkbox" onclick="toggleCheck(this)">Perfect bezel</label></li>
                <li><label><input type="checkbox" onclick="toggleCheck(this)">Fitted SEL</label></li>
                <li><label><input type="checkbox" onclick="toggleCheck(this)">Aligned hands</label></li>
                <li><label><input type="checkbox" onclick="toggleCheck(this)">Sharp dial</label></li>
                <li><label><input type="checkbox" onclick="toggleCheck(this)">Correct timegrapher</label></li>
                <li><label><input type="checkbox" onclick="toggleCheck(this)">No visible defects</label></li>
            </ul>
        </div>
        <div class="credits">built by jrverdes</div>
    </div>
    <div class="main-area" id="mainArea">
        <div class="image-container" id="imageContainer"><img id="mainImage" style="display: none;"></div>
        <div class="tools-overlay" id="toolsOverlay"></div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
</div>
<div class="controls">
    <button class="control-btn" onclick="rotateImage(-0.1)" title="Rotate Left"><span class="material-icons">rotate_left</span></button>
    <button class="control-btn" onclick="rotateImage(0.1)" title="Rotate Right"><span class="material-icons">rotate_right</span></button>
</div>
<div class="info-panel" id="infoPanel" style="display: none;">
    <div>Zoom: <span id="zoomLevel">100%</span></div>
    <div>Rotation: <span id="rotationLevel">0°</span></div>
</div>
<input type="file" class="file-input" id="fileInput" accept="image/*">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
let imageContainer = document.getElementById('imageContainer');
let mainImage = document.getElementById('mainImage');
let toolsOverlay = document.getElementById('toolsOverlay');
let currentZoom = 1;
let currentRotation = 0;
let isDragging = false;
let lastX = 0;
let lastY = 0;
let tools = [];
let imagePosition = { x: 0, y: 0 };

// --- HAMBURGER MENU MOBILE ---
const sidebar = document.getElementById('sidebar');
const sidebarToggle = document.getElementById('sidebarToggle');
const sidebarOverlay = document.getElementById('sidebarOverlay');

function closeSidebarMobile() {
    sidebar.classList.remove('visible');
    if(sidebarOverlay) sidebarOverlay.style.opacity = '0';
}
function openSidebarMobile() {
    sidebar.classList.add('visible');
    if(sidebarOverlay) sidebarOverlay.style.opacity = '1';
}
sidebarToggle.addEventListener('click', function(e){
    e.stopPropagation();
    if (sidebar.classList.contains('visible')) {
        closeSidebarMobile();
    } else {
        openSidebarMobile();
    }
});
if(sidebarOverlay){
    sidebarOverlay.addEventListener('click', closeSidebarMobile);
}
document.addEventListener('keydown', function(e){
    if (e.key === "Escape") closeSidebarMobile();
});

// --------- RESTO DE FUNCIONALIDAD (tu JS original) -----------
function init() {
    setupEventListeners();
    updateInfo();
     // --- HACER VISIBLE LA SIDEBAR SOLO EN MÓVIL ---
    if(window.innerWidth <= 768) sidebar.classList.add('visible');
}
function setupEventListeners() {
    document.addEventListener('wheel', handleWheel, { passive: false });
    imageContainer.addEventListener('mousedown', handleMouseDown);
    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);
    imageContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
    document.addEventListener('touchmove', handleTouchMove, { passive: false });
    document.addEventListener('touchend', handleTouchEnd);
    document.addEventListener('keydown', handleKeyDown);
    document.getElementById('fileInput').addEventListener('change', handleFileLoad);
    document.addEventListener('contextmenu', handleRightClick);
}
function handleWheel(e) {
    e.preventDefault();
    const rulerStep = 4;
    const lineStep = 1;
    const sensitivity = 0.22;

    const target = e.target.closest('.index-ruler');
    if (target) {
        const currentSize = parseInt(target.style.width) || 300;
        let delta = (e.deltaY > 0 ? -rulerStep : rulerStep) * sensitivity;
        if (!delta) delta = (e.deltaY > 0 ? -1 : 1);
        const newSize = Math.max(50, Math.min(800, Math.round(currentSize + delta)));
        if (currentSize !== newSize) {
            target.style.width = target.style.height = newSize + 'px';
        }
        return;
    }
    const lineTarget = e.target.closest('.horizontal-line, .vertical-line');
    if (lineTarget) {
        const isHorizontal = lineTarget.classList.contains('horizontal-line');
        const currentSize = parseInt(lineTarget.style[isHorizontal ? 'height' : 'width']) || 3;
        let delta = (e.deltaY > 0 ? -lineStep : lineStep) * sensitivity;
        if (!delta) delta = (e.deltaY > 0 ? -1 : 1);
        const newSize = Math.max(1, Math.min(8, Math.round(currentSize + delta)));
        if (currentSize !== newSize)
            lineTarget.style[isHorizontal ? 'height' : 'width'] = newSize + 'px';
        return;
    }
    const imageDelta = e.deltaY > 0 ? 0.998 : 1.002;
    currentZoom = Math.max(0.2, Math.min(10, currentZoom * imageDelta));
    updateImageTransform();
    updateInfo();
}
function handleMouseDown(e) {
    if (e.target === mainImage || e.target === imageContainer) {
        isDragging = true;
        lastX = e.clientX;
        lastY = e.clientY;
        imageContainer.classList.add('dragging');
        e.preventDefault();
    }
}
function handleMouseMove(e) {
    if (isDragging) {
        const deltaX = e.clientX - lastX;
        const deltaY = e.clientY - lastY;
        imagePosition.x += deltaX;
        imagePosition.y += deltaY;
        updateImageTransform();
        lastX = e.clientX;
        lastY = e.clientY;
    }
}
function handleMouseUp(e) {
    isDragging = false;
    imageContainer.classList.remove('dragging');
}
function handleTouchStart(e) { if (e.touches.length === 1) handleMouseDown(e.touches[0]); }
function handleTouchMove(e) { e.preventDefault(); if (e.touches.length === 1) handleMouseMove(e.touches[0]); }
function handleTouchEnd(e) { handleMouseUp(e); }
function handleKeyDown(e) {
    if (e.code === 'ArrowLeft') { rotateImage(-0.1); e.preventDefault(); }
    else if (e.code === 'ArrowRight') { rotateImage(0.1); e.preventDefault(); }
}
function handleRightClick(e) {
    const tool = e.target.closest('.index-ruler, .horizontal-line, .vertical-line');
    if (tool) { e.preventDefault(); tool.remove(); tools = tools.filter(t => t !== tool); }
}
function loadImage() { document.getElementById('fileInput').click(); }
function handleFileLoad(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            mainImage.src = event.target.result;
            mainImage.style.display = 'block';
            currentZoom = 1;
            currentRotation = 0;
            imagePosition = { x: 0, y: 0 };
            updateImageTransform();
            updateInfo();
            document.getElementById('infoPanel').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}
function rotateImage(degrees) {
    currentRotation += degrees;
    currentRotation = currentRotation % 360;
    updateImageTransform();
    updateInfo();
}
function updateImageTransform() {
    const translateX = -50 + (imagePosition.x / window.innerWidth) * 100;
    const translateY = -50 + (imagePosition.y / window.innerHeight) * 100;
    imageContainer.style.transform = `translate(${translateX}%, ${translateY}%)`;
    mainImage.style.transform = `scale(${currentZoom}) rotate(${currentRotation}deg)`;
}
function addIndexRuler() {
    const ruler = document.createElement('div');
    ruler.className = 'index-ruler';
    ruler.style.width = '300px';
    ruler.style.height = '300px';
    ruler.style.left = '50%';
    ruler.style.top = '50%';
    ruler.style.transform = 'translate(-50%, -50%)';
    makeDraggable(ruler);
    toolsOverlay.appendChild(ruler);
    tools.push(ruler);
}
function addHorizontalLine() {
    const line = document.createElement('div');
    line.className = 'horizontal-line';
    line.innerHTML = `<span class="line-icon" title="Horizontal">—</span>`;
    line.style.top = '50%';
    makeDraggable(line, 'vertical');
    toolsOverlay.appendChild(line);
    tools.push(line);
}
function addVerticalLine() {
    const line = document.createElement('div');
    line.className = 'vertical-line';
    line.innerHTML = `<span class="line-icon" title="Vertical">
    <svg width="18" height="18" viewBox="0 0 18 18" style="display:inline;vertical-align:middle">
        <circle cx="9" cy="9" r="8" fill="#FFFFFF22" stroke="#fff" stroke-width="1.6"/>
        <polyline points="9,4 9,14" stroke="#fff" stroke-width="2.1" fill="none"/>
        <polygon points="6,7 9,4 12,7" fill="#fff"/>
        <polygon points="6,11 9,14 12,11" fill="#fff"/>
    </svg>
    </span>`;
    line.style.left = '50%';
    makeDraggable(line, 'horizontal');
    toolsOverlay.appendChild(line);
    tools.push(line);
}
function makeDraggable(element, direction = 'both') {
    let drag = false, sX, sY, sLeft, sTop;
    element.addEventListener('mousedown', function(e) {
        drag = true; sX = e.clientX; sY = e.clientY;
        sLeft = parseInt(element.style.left) || 0;
        sTop = parseInt(element.style.top) || 0;
        e.preventDefault(); e.stopPropagation();
    });
    document.addEventListener('mousemove', function(e) {
        if (!drag) return;
        const dx = e.clientX - sX;
        const dy = e.clientY - sY;
        if (direction === 'both' || direction === 'horizontal') element.style.left = (sLeft + dx) + 'px';
        if (direction === 'both' || direction === 'vertical') element.style.top = (sTop + dy) + 'px';
    });
    document.addEventListener('mouseup', function() { drag = false; });
}
function toggleCheck(checkbox) {
    checkbox.parentNode.parentNode.classList.toggle('completed', checkbox.checked);
}
function saveImage() {
    var mainArea = document.getElementById('mainArea');
    html2canvas(mainArea, {
        backgroundColor: "#111",
        useCORS: true
    }).then(function(canvas) {
        var link = document.createElement('a');
        link.download = 'qc_' + new Date().toISOString().replace(/[:\-T\.]/g,'').slice(0,15) + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
    });
}
function updateInfo() {
    document.getElementById('zoomLevel').textContent = Math.round(currentZoom * 100) + '%';
    document.getElementById('rotationLevel').textContent = Math.round(currentRotation * 10) / 10 + '°';
}
init();
</script>
</body>
</html>
